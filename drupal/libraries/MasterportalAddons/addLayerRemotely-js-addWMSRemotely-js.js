(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{3397:function(I,H,f){(function(l,O){var D=Object.create,m=Object.defineProperty,F=Object.getOwnPropertyDescriptor,_=Object.getOwnPropertyNames,B=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,z=(e,r)=>{for(var n in r)m(e,n,{get:r[n],enumerable:!0})},M=(e,r,n,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of _(r))!V.call(e,i)&&i!==n&&m(e,i,{get:()=>r[i],enumerable:!(o=F(r,i))||o.enumerable});return e},h=(e,r,n)=>(n=e!=null?D(B(e)):{},M(r||!e||!e.__esModule?m(n,"default",{value:e,enumerable:!0}):n,e)),U=e=>M(m({},"__esModule",{value:!0}),e),T={};z(T,{default:()=>G,getIfInExtent:()=>x,getParsedTitle:()=>p,getReversedData:()=>E,isVersionEnabled:()=>C,parseLayer:()=>P}),I.exports=U(T);var W=f(50),J=f(4),S=h(f(54)),N=h(f(20)),j=h(f(8));function G(e,r,n,o){if(e.includes("http:")){console.error("https required");return}l.trigger("Util","showLoader"),(0,N.default)({timeout:4e4,url:e+"?request=GetCapabilities&service=WMS"}).then(i=>i.data).then(i=>{var g,s;l.trigger("Util","hideLoader");try{const d=new W.WMSCapabilities,t=d.read(i),u=t?.version,c=C(u),w=(s=(g=l.request("Parser","getPortalConfig"))==null?void 0:g.mapView)==null?void 0:s.extent,A=j.default.getters["Maps/projection"].code_;let L=x(t,w,A),v="external_",y=t;if(!c){const a=E(i);y=d.read(a),L=x(y,w,A)}if(!L){console.error("Layer is outside the map extent");return}l.request("Parser","getItemByAttributes",{id:"ExternalLayer"})===void 0&&(l.trigger("Parser","addFolder",n,"ExternalLayer","tree",0),l.trigger("ModelList","renderTree"),O("#Overlayer").parent().after(O("#ExternalLayer").parent())),v=v+p(y.Service.Title),l.trigger("Parser","addFolder",y.Service.Title,v,"ExternalLayer",0),r?r.forEach(a=>{const X={id:p(a.title),name:a.title,parentId:v,level:1,layers:a.name,url:e,version:u,transparent:a.layerTransparent?a.layerTransparent:!0,isSelected:a.layerOn?!0:a.layerOn,time:a.layerTime?a.layerTime:!1,infoFormat:a.infoFormat?a.infoFormat:"text/xml",styles:a.style?a.style:"",cache:!1,datasets:[],featureCount:3,format:"image/png",gfiAttributes:"showAll",gutter:"0",isBaseLayer:!1,layerAttribution:"nicht vorhanden",legendURL:"",maxScale:"2500000",minScale:"0",singleTile:!1,supported:["2D","3D"],tilesize:"512",typ:"WMS",type:"layer",urlIsVisible:!0};l.trigger("Parser","addItem",X),l.trigger("ModelList","addModelsByAttributes",{id:p(a.title)})}):y.Capability.Layer.Layer.forEach(a=>{P(a,v,1,u,e),l.trigger("ModelList","addModelsByAttributes",{id:p(a.Title)})}),o&&l.trigger("Map","zoomToExtent",{extent:L}),l.trigger("ModelList","closeAllExpandedFolder")}catch(d){console.error(d)}},i=>{l.trigger("Util","hideLoader"),console.error(i)})}function P(e,r,n,o,i){Object.prototype.hasOwnProperty.call(e,"Layer")?(e.Layer.forEach(g=>{P(g,p(e.Title),n+1)}),l.trigger("Parser","addFolder",e.Title,p(e.Title),r,n,!1,!1,e.invertLayerOrder)):l.trigger("Parser","addLayer",e.Title,p(e.Title),r,n,e.Name,i,o,{isSelected:!0})}function C(e){if(typeof e!="string")return!1;const r=e.split(".");return parseInt(r[0],10)<1?!1:!(r.length>=2&&parseInt(r[0],10)===1&&parseInt(r[1],10)<3)}function x(e,r,n){var o,i,g;const s=(g=(i=(o=e?.Capability)==null?void 0:o.Layer)==null?void 0:i.BoundingBox)==null?void 0:g.filter(t=>t?.crs&&t?.crs.includes("EPSG")&&S.default.getProjection(t?.crs)!==void 0&&Array.isArray(t?.extent)&&t?.extent.length===4);let d;if(Array.isArray(s)&&s.length){let t=[],u=[];return s.forEach(c=>{c.crs===n&&(t=[c.extent[0],c.extent[1]],u=[c.extent[2],c.extent[3]])}),!t.length&&!u.length&&(t=S.default.transformCoord(s[0].crs,n,[s[0].extent[0],s[0].extent[1]]),u=S.default.transformCoord(s[0].crs,n,[s[0].extent[2],s[0].extent[3]])),d=[t[0],t[1],u[0],u[1]],!Array.isArray(r)||r.length!==4||(0,J.intersects)(r,d)?d:!1}return!0}function E(e){let r=new XMLSerializer().serializeToString(e);return r=r.replace(/<SRS>/g,"<CRS>").replace(/<\/SRS>/g,"</CRS>").replace(/SRS=/g,"CRS="),r=new DOMParser().parseFromString(r,"text/xml"),r}function p(e){return String(e).replace(/\s+/g,"-").replace(/\//g,"-").replace(/:/g,"-").replace(/\(/g,"-").replace(/\)/g,"-")}}).call(this,f(2),f(13))}}]);
